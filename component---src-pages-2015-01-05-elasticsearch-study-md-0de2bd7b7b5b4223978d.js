(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{Bl7J:function(e,t,n){"use strict";var a=n("dwav"),b=n("q1tI"),l=n.n(b),c=n("Wbzz"),r=function(e){var t=e.siteTitle;return l.a.createElement("header",{style:{background:"white",marginBottom:"1.45rem"}},l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"1.45rem 1.0875rem"}},l.a.createElement("h1",{style:{margin:0}},l.a.createElement(c.Link,{to:"/",style:{color:"black",textDecoration:"none"}},t))))};r.defaultProps={siteTitle:""};var i=r;n("8ypT"),t.a=function(e){var t=e.children,n=a.data;return l.a.createElement(l.a.Fragment,null,l.a.createElement(i,{siteTitle:n.site.siteMetadata.title}),l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"0 1.0875rem 1.45rem"}},l.a.createElement("main",null,t),l.a.createElement("footer",null,"© ",(new Date).getFullYear(),", Built with"," ",l.a.createElement("a",{href:"https://www.gatsbyjs.org"},"Gatsby"),"by ",n.site.siteMetadata.author)))}},dwav:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"title":"jangajan.com","author":"@ta1kt0me"}}}}')},gSOl:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return l})),n.d(t,"default",(function(){return i}));n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("91GP"),n("q1tI");var a=n("7ljp"),b=n("Bl7J");var l={},c={_frontmatter:l},r=b.a;function i(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,b={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(b[n]=e[n]);return b}(e,["components"]);return Object(a.b)(r,Object.assign({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"仕事で使っているので、elasticsearchとは、どう使うのかというところを学んでいきます。",Object(a.b)("br",{parentName:"p"}),"\n","とりあえず、",Object(a.b)("a",Object.assign({parentName:"p"},{href:"http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/getting-started.html"}),"Getting Start"),"こなしていきます。"),Object(a.b)("h2",null,"Elasticsearchって？"),Object(a.b)("p",null,"REST APIでアクセスする、スケーラブルなオープンソースのテキスト検索・解析エンジンです。\nelasticsearchはindexのデータベース(スキーマレスなデータベース)を持っていて、それに対してREST API経由でアクセスしていきます。  "),Object(a.b)("h2",null,"どうやって使うの？"),Object(a.b)("p",null,"@@@インストール方法・起動方法の記事を準備@@@",Object(a.b)("br",{parentName:"p"}),"\n","以下に、REST APIを利用した場合のindexのデータベースへのアクセス方法を示します。",Object(a.b)("br",{parentName:"p"}),"\n","が、その前に用語を3つだけRDBにたとえてみます。  "),Object(a.b)("table",null,Object(a.b)("thead",{parentName:"table"},Object(a.b)("tr",{parentName:"thead"},Object(a.b)("th",Object.assign({parentName:"tr"},{align:"left"}),"用語"),Object(a.b)("th",Object.assign({parentName:"tr"},{align:"left"}),"意味"))),Object(a.b)("tbody",{parentName:"table"},Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",Object.assign({parentName:"tr"},{align:"left"}),"index"),Object(a.b)("td",Object.assign({parentName:"tr"},{align:"left"}),"RDBでいうところのDatabase")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",Object.assign({parentName:"tr"},{align:"left"}),"type"),Object(a.b)("td",Object.assign({parentName:"tr"},{align:"left"}),"RDBでいうところのTable")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",Object.assign({parentName:"tr"},{align:"left"}),"document"),Object(a.b)("td",Object.assign({parentName:"tr"},{align:"left"}),"RDBでいうところのRecord")))),Object(a.b)("h3",null,"indexを作成"),Object(a.b)("p",null,"今回はコマンドライン上から、curlコマンドを使ってelasticsearchにアクセスしていきます。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"# customerというindexをhttpリクエストで作成\n$ curl -XPUT 'localhost:9200/customer?pretty'\n# 標準出力の結果\n{\n  \"acknowledged\" : true\n}\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"curl"),"コマンドを利用してhttpのリクエストを投げる"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"-X"),"オプションで",Object(a.b)("inlineCode",{parentName:"li"},"PUT"),"メソッドを利用する"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"pretty"),"は出力結果を整形してくれるだけなので、つけなくても問題ない"),Object(a.b)("li",{parentName:"ul"},"レスポンスはJSON形式です。")),Object(a.b)("p",null,"さて、次はindexができたか確認してみます。"),Object(a.b)("h3",null,"indexの一覧を取得"),Object(a.b)("p",null,"以下のコマンドでindexの一覧を取得します。単に情報を取得する場合は",Object(a.b)("inlineCode",{parentName:"p"},"GET"),"メソッドを利用します。REST APIですね。"),Object(a.b)("p",null,"蛇足ですが、",Object(a.b)("inlineCode",{parentName:"p"},"curl: (7) Failed to connect to localhost port 9200: Connection refused"),"が発生する場合、",Object(a.b)("inlineCode",{parentName:"p"},"--ipv4"),"をつけてみてください。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"$ curl -XGET 'localhost:9200/_cat/indices?v'\n")),Object(a.b)("p",null,"一覧の中に",Object(a.b)("inlineCode",{parentName:"p"},"customer"),"がいれば、indexの作成成功です。",Object(a.b)("br",{parentName:"p"}),"\n","続いて実際のデータとなるdocumentを登録してみましょう。"),Object(a.b)("h3",null,"documentを登録"),Object(a.b)("p",null,"登録するdocumentは以下です。"),Object(a.b)("table",null,Object(a.b)("thead",{parentName:"table"},Object(a.b)("tr",{parentName:"thead"},Object(a.b)("th",Object.assign({parentName:"tr"},{align:"center"}),"キー"),Object(a.b)("th",Object.assign({parentName:"tr"},{align:"center"}),"値"))),Object(a.b)("tbody",{parentName:"table"},Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"name"),Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"John Doe")))),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"$ curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '\nquote> {\nquote>   \"name\": \"John Doe\"\nquote> }'\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"urlは",Object(a.b)("inlineCode",{parentName:"li"},"/customer/external/1"),"と指定します。",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"customer"),"はindexですね。"),Object(a.b)("li",{parentName:"ul"},"では次の",Object(a.b)("inlineCode",{parentName:"li"},"external"),"はなんでしょうか。これが、typeです。個人的にはtableというより、一般的なカテゴリーに近いのかなって気がします。"),Object(a.b)("li",{parentName:"ul"},"最後の",Object(a.b)("inlineCode",{parentName:"li"},"1"),"はdocumentのIDです。つけないやり方もあります。"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"-d"),"オプション(-data)でdocumentのデータを連想配列形式で記述します。")),Object(a.b)("p",null,"ではdocumentが登録できたのか確認してみましょう。"),Object(a.b)("h3",null,"documentを取得"),Object(a.b)("p",null,"indexの一覧の取得方法と、documentの登録方法から、URLの意味は汲み取れると思います。",Object(a.b)("inlineCode",{parentName:"p"},"customer"),"indexの",Object(a.b)("inlineCode",{parentName:"p"},"external"),"typeのIDが",Object(a.b)("inlineCode",{parentName:"p"},"1"),"のdocumentを取得する(",Object(a.b)("inlineCode",{parentName:"p"},"GET"),")というリクエストです。 "),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),'$ curl -XGET \'localhost:9200/customer/external/1?pretty\'\n# 標準出力の結果\n{\n  "_index" : "customer",\n  "_type" : "external",\n  "_id" : "1",\n  "_version" : 1,\n  "found" : true,\n  "_source":\n    {\n      "name": "John Doe"\n    }\n}\n')),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"documentが見つかると、",Object(a.b)("inlineCode",{parentName:"li"},"found"),"は",Object(a.b)("inlineCode",{parentName:"li"},"true")),Object(a.b)("li",{parentName:"ul"},"取得したdocumentの内容は",Object(a.b)("inlineCode",{parentName:"li"},"_source"),"をキーにした連想配列")),Object(a.b)("p",null,"無事に取得できました！でも、登録したdocumentの内容が間違っていました。よくあることですね、直しましょう。"),Object(a.b)("h2",null,"documentを更新"),Object(a.b)("p",null,"更新のリクエストはdocumentを登録する時と、",Object(a.b)("inlineCode",{parentName:"p"},"name"),"の値以外全て一緒です。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{}),'$ curl -XPUT \'localhost:9200/customer/external/1?pretty\' -d \'\nquote> {\nquote>   "name": "Jane Doe"\nquote> }\'\n{\n  "_index" : "customer",\n  "_type" : "external",\n  "_id" : "1",\n  "_version" : 2,\n  "created" : false\n}\n')),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"すでに存在するdocumentに対する",Object(a.b)("inlineCode",{parentName:"li"},"PUT"),"の場合は",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"_version"),"が+1"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"created"),"が",Object(a.b)("inlineCode",{parentName:"li"},"false"))))),Object(a.b)("p",null,"もう一度、documentを取得してみてください。documentが更新されていることを確認できると思います。イエイ。"),Object(a.b)("p",null,"ところが、登録したdocument、実はいらないデータでした。消しましょう。"),Object(a.b)("h2",null,"documentを削除"),Object(a.b)("p",null,"削除の時は",Object(a.b)("inlineCode",{parentName:"p"},"DELETE"),"メソッドを使います。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{}),'$ curl -XDELETE \'localhost:9200/customer/external/1?pretty\'\n{\n  "found" : true,\n  "_index" : "customer",\n  "_type" : "external",\n  "_id" : "1",\n  "_version" : 2\n}\n')),Object(a.b)("p",null,"documentを取得してみてください。存在しないため、",Object(a.b)("inlineCode",{parentName:"p"},"found"),"が",Object(a.b)("inlineCode",{parentName:"p"},"false"),"担っているともいます。"),Object(a.b)("p",null,"実際にリクエストを投げながら使うことで、elasticsearchに、どうアクセスして、どんな結果が返ってくるのかイメージできてきたと思います。"),Object(a.b)("p",null,"次はRubyでの使い方を見てみましょう。"))}i.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-2015-01-05-elasticsearch-study-md-0de2bd7b7b5b4223978d.js.map