(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{Bl7J:function(e,t,n){"use strict";var a=n("dwav"),i=n("q1tI"),r=n.n(i),l=n("Wbzz"),o=function(e){var t=e.siteTitle;return r.a.createElement("header",{style:{background:"white",marginBottom:"1.45rem"}},r.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"1.45rem 1.0875rem"}},r.a.createElement("h1",{style:{margin:0}},r.a.createElement(l.Link,{to:"/",style:{color:"black",textDecoration:"none"}},t))))};o.defaultProps={siteTitle:""};var s=o;n("8ypT"),t.a=function(e){var t=e.children,n=a.data;return r.a.createElement(r.a.Fragment,null,r.a.createElement(s,{siteTitle:n.site.siteMetadata.title}),r.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"0 1.0875rem 1.45rem"}},r.a.createElement("main",null,t),r.a.createElement("footer",null,"© ",(new Date).getFullYear(),", Built with"," ",r.a.createElement("a",{href:"https://www.gatsbyjs.org"},"Gatsby"),"by ",n.site.siteMetadata.author)))}},"VG/c":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return r})),n.d(t,"default",(function(){return s}));n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("91GP"),n("q1tI");var a=n("7ljp"),i=n("Bl7J");var r={},l={_frontmatter:r},o=i.a;function s(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["components"]);return Object(a.b)(o,Object.assign({},l,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Railsで特定するレコードが存在するかbooleanで取得したい時、"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Table.exists?(a: id)"),Object(a.b)("li",{parentName:"ol"},"!!Table.find_by(a: id)")),Object(a.b)("p",null,"いずれのやり方のほうが処理が早いか計測してみました。"),Object(a.b)("h1",null,"ケース"),Object(a.b)("p",null,"環境は、",Object(a.b)("inlineCode",{parentName:"p"},"Rails 4.1.7"),"と",Object(a.b)("inlineCode",{parentName:"p"},"ruby 2.1.4"),"です。"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"1万件のレコードがあるVoteテーブルに対して、voting_user_idを検索条件に指定して該当するレコードがあるか確認する。"),Object(a.b)("li",{parentName:"ul"},"Vote.voting_user_idにはIndexをつける"),Object(a.b)("li",{parentName:"ul"},"1万回問い合わせした時間で比較")),Object(a.b)("p",null,"1の場合、",Object(a.b)("inlineCode",{parentName:"p"},"Vote.exists?(voting_user_id: 1098)"),Object(a.b)("br",{parentName:"p"}),"\n","2の場合、",Object(a.b)("inlineCode",{parentName:"p"},"!!Vote.find_by(voting_user_id: 1098)")),Object(a.b)("p",null,"となります。"),Object(a.b)("h1",null,"計測"),Object(a.b)("p",null,"計測してみました。Databaseはsqlite3です。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb"}),'# 1.exists?のケース\nBenchmark.realtime { 10000.times {|e|Vote.exists?(voting_user_id: 1098)}}\n# SQL: SELECT  1 AS one FROM "votes"  WHERE "votes"."voting_user_id" = 1098 LIMIT 1\n# => 6.658646\n\n# 2.find_byのケース\nBenchmark.realtime { 10000.times {|e|!!Vote.find_by(voting_user_id: 1098)}}\n# SQL: SELECT  "votes".* FROM "votes"  WHERE "votes"."voting_user_id" = 1098 LIMIT 1\n# => 5.506756\n')),Object(a.b)("p",null,"find_byのほうが早いんですね。取得結果の情報が多い分、find_byのほうがメモリは食ってそうなので、遅いかなと思ったら想像と逆の結果でした。"),Object(a.b)("h1",null,"Postgresqlで試してみる"),Object(a.b)("p",null,"アプリをHeroku+Postgresqlで動かす機会が多いので、ローカルのPostgresqlで試してみます。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb"}),'# 1.exists?のケース\nBenchmark.realtime { 10000.times {|e|Vote.exists?(voting_user_id: 1098)}}\n# SQL: SELECT  1 AS one FROM "votes"  WHERE "votes"."voting_user_id" = 1098 LIMIT 1\n# => 9.905989\n\n# 2.find_byのケース\nBenchmark.realtime { 10000.times {|e|!!Vote.find_by(voting_user_id: 1098)}}\n# SQL: SELECT  "votes".* FROM "votes"  WHERE "votes"."voting_user_id" = 1098 LIMIT 1\n# => 7.289921\n')),Object(a.b)("p",null,"やっぱり、find_byの方が早いのかー。"))}s.isMDXComponent=!0},dwav:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"title":"jangajan.com","author":"@ta1kt0me"}}}}')}}]);
//# sourceMappingURL=component---src-pages-2014-11-10-exists-or-find-by-in-rails-md-5baf1985d3ed600b091d.js.map