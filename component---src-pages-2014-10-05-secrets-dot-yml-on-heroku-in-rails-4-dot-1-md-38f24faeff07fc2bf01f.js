(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"1Vtv":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return l})),n.d(t,"default",(function(){return i}));n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("91GP"),n("q1tI");var a=n("7ljp"),r=n("Bl7J");var l={},c={_frontmatter:l},b=r.a;function i(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["components"]);return Object(a.b)(b,Object.assign({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Rails4.1でherokuへのデプロイに失敗(Missing ",Object(a.b)("inlineCode",{parentName:"p"},"secret_key_base"),")"),Object(a.b)("p",null,"Rails4.1から",Object(a.b)("inlineCode",{parentName:"p"},"secrets.yml"),"がサポートされました。",Object(a.b)("br",{parentName:"p"}),"\n","これの扱いが良くわかっていなかったため、heroku push後、以下のエラーが発生してアプリ起動に失敗しました。"),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"app error: Missing ",Object(a.b)("inlineCode",{parentName:"p"},"secret_key_base")," for 'production' environment, set this value in ",Object(a.b)("inlineCode",{parentName:"p"},"config/secrets.yml")," (RuntimeError)")),Object(a.b)("h1",null,"解決策"),Object(a.b)("p",null,"ちなみに、heroku create済みです。"),Object(a.b)("h2",null,"secrets.ymlをgitで管理する"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},".gitignore"),"に",Object(a.b)("inlineCode",{parentName:"p"},"/config/secrets.yml"),"を含めてしまっている場合は、削除してください。",Object(a.b)("br",{parentName:"p"}),"\n","その後、git管理化におくため、commitします。"),Object(a.b)("p",null,"productionの",Object(a.b)("inlineCode",{parentName:"p"},"secret_key_base"),"は環境変数から取得するようになっているため、herokuの環境変数に",Object(a.b)("inlineCode",{parentName:"p"},"SECRET_KEY_BASE"),"を設定する必要があります。"),Object(a.b)("h2",null,"環境変数SECRET_KEY_BASEを設定する"),Object(a.b)("p",null,"やり方が２通りあります。"),Object(a.b)("h3",null,"heroku_secretsを使う"),Object(a.b)("p",null,"この方法では、",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/alexpeattie/heroku_secrets"}),"heroku_secrets"),"というgemを利用することでherokuコマンドを打つ必要はありません。"),Object(a.b)("h4",null,"gemのインストール"),Object(a.b)("p",null,"Gemfileにgemを追加して、bundle updateを実行します。  "),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"Gemfile",Gemfile:!0}),"gem 'heroku_secrets', github: 'alexpeattie/heroku_secrets'\n")),Object(a.b)("h4",null,"rakeコマンドを実行"),Object(a.b)("p",null,"その後、rakeコマンドを実行します。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"bundle exec rake heroku:secrets[app-name] RAILS_ENV=production\n")),Object(a.b)("p",null,"もう一つの方も作業量としては変わらなそうですね。"),Object(a.b)("h3",null,"heroku configで環境変数を設定する"),Object(a.b)("p",null,"この方法では、heroku config:add で環境変数を直接設定します。"),Object(a.b)("h4",null,"設定値を作成する"),Object(a.b)("p",null,"環境変数に設定する値を取得します。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"bundle exec rake secret RAILS_ENV=production\n")),Object(a.b)("h4",null,"herokuの環境変数を設定する"),Object(a.b)("p",null,"上記の実行結果を値とした環境変数(SECRET_KEY_BASE)を設定します。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"heroku config:add SECRET_KEY_BASE=rake secretの実行結果\n")))}i.isMDXComponent=!0},Bl7J:function(e,t,n){"use strict";var a=n("dwav"),r=n("q1tI"),l=n.n(r),c=n("Wbzz"),b=function(e){var t=e.siteTitle;return l.a.createElement("header",{style:{background:"white",marginBottom:"1.45rem"}},l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"1.45rem 1.0875rem"}},l.a.createElement("h1",{style:{margin:0}},l.a.createElement(c.Link,{to:"/",style:{color:"black",textDecoration:"none"}},t))))};b.defaultProps={siteTitle:""};var i=b;n("8ypT"),t.a=function(e){var t=e.children,n=a.data;return l.a.createElement(l.a.Fragment,null,l.a.createElement(i,{siteTitle:n.site.siteMetadata.title}),l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"0 1.0875rem 1.45rem"}},l.a.createElement("main",null,t),l.a.createElement("footer",null,"© ",(new Date).getFullYear(),", Built with"," ",l.a.createElement("a",{href:"https://www.gatsbyjs.org"},"Gatsby"),"by ",n.site.siteMetadata.author)))}},dwav:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"title":"jangajan.com","author":"@ta1kt0me"}}}}')}}]);
//# sourceMappingURL=component---src-pages-2014-10-05-secrets-dot-yml-on-heroku-in-rails-4-dot-1-md-38f24faeff07fc2bf01f.js.map