<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby-on-rails | JanGaJan.com]]></title>
  <link href="http://jangajan.com/blog/categories/ruby-on-rails/atom.xml" rel="self"/>
  <link href="http://jangajan.com/"/>
  <updated>2014-09-12T19:02:15+09:00</updated>
  <id>http://jangajan.com/</id>
  <author>
    <name><![CDATA[talkto_me]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[I18nの設定でdatetime_selectのエラー対応]]></title>
    <link href="http://jangajan.com/blog/2014/09/12/perfect-rails-i18n/"/>
    <updated>2014-09-12T18:25:27+09:00</updated>
    <id>http://jangajan.com/blog/2014/09/12/perfect-rails-i18n</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4774165166/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4774165166&linkCode=as2&tag=pochan0919-22">パーフェクト Ruby on Rails</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=pochan0919-22&l=as2&o=9&a=4774165166" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />を、第6章からやってます。</p>

<p>日本語対応のi18nの設定でエラーが発生しました。<br/>
補足ですが、私のRailsの環境は<code>4.1.5</code>です。</p>

<pre><code class="rb">ActionView::Template::Error (undefined method `map' for "translation missing: ja.date.order":String):
    27:   &lt;/div&gt;
    28:   &lt;div class="form-group"&gt;
    29:     &lt;%= f.label :end_time %&gt;
    30:     &lt;%= f.datetime_select :end_time, start_year: now.year, end_year: now.year + 1 %&gt;
    31:   &lt;/div&gt;
    32:   &lt;div class="form-group"&gt;
    33:     &lt;%= f.label :content %&gt;
  app/views/events/new.html.erb:30:in `block in _app_views_events_new_html_erb__622987462779560017_70179900721920'
  app/views/events/new.html.erb:5:in `_app_views_events_new_html_erb__622987462779560017_70179900721920'


  Rendered vendor/bundle/ruby/2.1.0/gems/actionpack-4.1.5/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.8ms)
  Rendered vendor/bundle/ruby/2.1.0/gems/actionpack-4.1.5/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.5ms)
  Rendered vendor/bundle/ruby/2.1.0/gems/actionpack-4.1.5/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (16.9ms)
</code></pre>

<!-- more -->


<h1>date.orderの指定</h1>

<h2>発生箇所</h2>

<p>該当するソースコードはこちらです。<br/>
ちなみに、i18nを無効化(<code>config.i18n.default_locale</code>を初期状態のようにコメントアウト)していると発生しません。</p>

<pre><code>  &lt;div class="form-group"&gt;
    &lt;%= f.label :start_time %&gt;
    &lt;%= f.datetime_select :start_time, start_year: now.year, end_year: now.year + 1 %&gt;
  &lt;/div&gt;
</code></pre>

<p>エラーメッセージからすると、<code>ja.date.order</code>で翻訳に失敗しちゃったよテヘってなってるんで、ja.yml修正すれば良さそう。</p>

<h2>解決策</h2>

<p>2つあります。</p>

<p><a href="https://github.com/rails/rails/blob/a8eb6018318f65e34486da8d1860b3f0d774383d/guides/source/i18n.md#action-view-helper-methods">ここ</a>に書いてありますね。</p>

<blockquote><p>datetime_select also looks up the order option from date.order (unless you pass the option explicitly).</p></blockquote>

<h3>ja.ymlに設定を追加</h3>

<p>翻訳ファイルの修正です。</p>

<pre><code class="yaml config/locals/ja.yml">ja:
  date:
    order: 
      - :year
      - :month
      - :day
</code></pre>

<p>なお、デフォルト(en)の場合は、activesupportの設定が適用されています。</p>

<h3>datetime_selectのoptionにorderを追加</h3>

<p>datetime_selectに<code>order</code>というoptionを追加することで、ja.ymlの修正をしないで対応できます。 <br/>
優先順位は<code>ja.ymlで設定 &lt; datetime_selectでoption指定</code>なので、必要があれば設定すればいいと思います。</p>

<pre><code>  &lt;div class="form-group"&gt;
    &lt;%= f.label :start_time %&gt;
    &lt;%= f.datetime_select :start_time, start_year: now.year, end_year: now.year + 1, order: [:year, :month, :day] %&gt;
  &lt;/div&gt;
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RailsでLocaleを指定する]]></title>
    <link href="http://jangajan.com/blog/2014/09/11/perfect-rails-locale/"/>
    <updated>2014-09-11T15:34:56+09:00</updated>
    <id>http://jangajan.com/blog/2014/09/11/perfect-rails-locale</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4774165166/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4774165166&linkCode=as2&tag=pochan0919-22">パーフェクト Ruby on Rails</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=pochan0919-22&l=as2&o=9&a=4774165166" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />を、第6章からやってます。</p>

<p>RailsにおけるTimezoneの設定方法です。
<code>config/application.rb</code>で設定します。</p>

<!-- more -->


<h1>Timezoneの日時設定</h1>

<p>Timezoneを指定した日時は、<code>Time.zone.nowe</code>で取得します。
デフォルトでは、<code>UTC</code>となります。</p>

<pre><code class="rb rails console">irb(main):001:0&gt; Time.zone.now
=&gt; Thu, 11 Sep 2014 06:33:19 UTC +00:00
</code></pre>

<p>これを<code>JST</code>に変更するには、以下の修正をします。</p>

<pre><code class="rb config/application.rb">module AwesomeEvents
  class Application &lt; Rails::Application
    ...
    config.time_zone = 'Tokyo'
    ...
  end
end
</code></pre>

<pre><code class="rb rails console">irb(main):003:0* Time.zone.now
=&gt; Thu, 11 Sep 2014 15:33:47 JST +09:00
</code></pre>

<h1>time_zoneに設定できる値</h1>

<p><code>config/application.rb</code>の<code>config.time_zone</code>に設定できる情報を確認できます。</p>

<pre><code class="sh"># time_zoneに設定できる値の一覧を表示
bundle exec rake time:zones:all

# 現在有効なtime_zoneの値を表示
# 設定していない場合、システムのタイムゾーンの値を表示
bundle exec rake time:zones:local
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bootstrap3 With Rails4]]></title>
    <link href="http://jangajan.com/blog/2014/09/10/perfect-rails-6-bootstrap/"/>
    <updated>2014-09-10T01:40:22+09:00</updated>
    <id>http://jangajan.com/blog/2014/09/10/perfect-rails-6-bootstrap</id>
    <content type="html"><![CDATA[<p><a href="http://www.amazon.co.jp/gp/product/4774165166/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4774165166&linkCode=as2&tag=pochan0919-22">パーフェクト Ruby on Rails</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=pochan0919-22&l=as2&o=9&a=4774165166" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />を、第6章からやってます。</p>

<p>Bootstrapの導入をzipから展開したので、Gemで導入する方法を調査しました。</p>

<!-- more -->


<h1>twitter-bootstrap-rails gemを使う</h1>

<p><a href="https://rubygems.org/gems/twitter-bootstrap-rails">twitter-bootstrap-rails</a>というGemを使うことで、テキスト同様の表示ができます。<br/>
(後の手順で一部テキスト外の修正を行う必要があるかもしれません)</p>

<pre><code class="sh">echo "gem 'twitter-bootstrap-rails', '&gt;= 3.1.1'" &gt;&gt; Gemfile
bundle install --path vendor/bundle
bundle exec rails generate bootstrap:install static
</code></pre>

<p><code>p.167 リスト6.3</code>の通り<code>app/views/layouts/application.html.erb</code>を修正すれば完了です。</p>
]]></content>
  </entry>
  
</feed>
