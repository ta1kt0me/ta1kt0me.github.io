(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"4tub":function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return l})),a.d(t,"default",(function(){return c}));a("rGqo"),a("yt8O"),a("Btvt"),a("RW0V"),a("91GP"),a("q1tI");var n=a("7ljp"),r=a("Bl7J");var l={},s={_frontmatter:l},b=r.a;function c(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,["components"]);return Object(n.b)(b,Object.assign({},s,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)("p",null,"ユーザーに紐づくタスクに、タグ付けをするという機能を実現する方法です。",Object(n.b)("br",{parentName:"p"}),"\n",Object(n.b)("inlineCode",{parentName:"p"},"acts-as-taggable-on"),"というgemを利用することで簡単(苦戦した...)にタグ機能は実現できるそうです。",Object(n.b)("br",{parentName:"p"}),"\n","なんとかできたっぽい...  "),Object(n.b)("p",null,"環境は、こんな感じです。"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Rails 4.1.6"),Object(n.b)("li",{parentName:"ul"},"ruby 2.1.2p95"),Object(n.b)("li",{parentName:"ul"},"acts-as-taggable-on 3.4.2")),Object(n.b)("p",null,"Githubの",Object(n.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/mbleigh/acts-as-taggable-on#tag-ownership"}),"README"),"を参考にしました"),Object(n.b)("h1",null,"Model"),Object(n.b)("p",null,"そもそもリレーション関係の設定でハマりましたが、これで良さそうです。",Object(n.b)("br",{parentName:"p"}),"\n","関係としては",Object(n.b)("inlineCode",{parentName:"p"},"user 1-n task"),"となり、taskにタグを設定します。",Object(n.b)("br",{parentName:"p"}),"\n","タグは、userごとに別々に管理します。  "),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"app/models/user.rb","app/models/user.rb":!0}),"class User < ActiveRecord::Base\n  acts_as_tagger\n  has_many :tasks, dependent: :destroy\n  ...\nend\n")),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"app/models/task.rb","app/models/task.rb":!0}),"class Task < ActiveRecord::Base\n  acts_as_taggable\n  belongs_to :user\n  ...\nend\n")),Object(n.b)("h1",null,"View"),Object(n.b)("p",null,"タグのところだけピックアップ。",Object(n.b)("br",{parentName:"p"}),"\n","（簡単なサンプル作れば良かった）",Object(n.b)("br",{parentName:"p"}),"\n","画面表示するController内のメソッドで、選択可能なタグを",Object(n.b)("inlineCode",{parentName:"p"},"@user_tags"),"に入れています。",Object(n.b)("br",{parentName:"p"}),"\n","タグは複数選択可能にするため、checkboxを利用しました。",Object(n.b)("br",{parentName:"p"}),"\n","checkbox生成でrailsの仕組みを利用しようとしたのですが、以下の2点を実現しようとしてうまいやり方が見つからなかった...  "),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"labelでクリック連携"),Object(n.b)("li",{parentName:"ul"},"valueの値をタグの名前")),Object(n.b)("p",null,"form_for内に記述します。  "),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-haml",metastring:"app/views/tasks/_form.html.haml","app/views/tasks/_form.html.haml":!0}),'/ @user_tagsはcontrollerで配列で設定 ex) => ["tag1", "tag2"]\n- @user_tags.each do |tag|\n  / tagを複数選択可能にするため、checkboxを利用\n  %input{id:"tag-#{tag}" ,name:\'task[tag_list][]\', type:\'checkbox\',value:"#{tag}"}\n  %label{for:"tag-#{tag}"}\n    %span.task-tag\n      = "#{tag}"\n')),Object(n.b)("p",null,"タグ付けよりもrailsでcheckbox使うところに時間とられた...宿題ですね。  "),Object(n.b)("h1",null,"Controller"),Object(n.b)("p",null,"リクエストのtask","[tag_list]","という値の中に、タグが含まれます。",Object(n.b)("br",{parentName:"p"}),"\n",Object(n.b)("inlineCode",{parentName:"p"},"permit"),"で、配列をチェックしたい場合は、",Object(n.b)("inlineCode",{parentName:"p"},"tag_list: []"),"と指定してあげる必要がありました。  "),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"app/controllers/tasks_controller.rb","app/controllers/tasks_controller.rb":!0}),"class TasksController < ApplicationController\n  ...\n  def create\n    # current_user => User.find(session[:user_id])\n    @task = current_user.tasks.build(task_params)\n    @task.user = current_user\n    # tagの設定処理 :withには'tag1, tag2'という形式の文字列を設定することでタグを登録できる\n    current_user.tag(@task, :with => @task.tag_list.join(', '), :on => :tags)\n    if @task.save\n      # 成功処理\n    else\n      # 失敗処理\n    end\n  end\n  ...\n\n  private\n  def task_params\n    params.require(:task).permit(\n      # tag_list: []を指定することで、checkboxの複数の値を配列にして、tag_listに設定可能になる\n      :id, :name, :deadline, tag_list: []\n    )\n  end\nend\n")),Object(n.b)("p",null,"もしかしたらもっといいやり方があるかもしれません。",Object(n.b)("br",{parentName:"p"}),"\n","気をつける場所はいくつかあるものの、意外と簡単かも。  "),Object(n.b)("h1",null,"補足"),Object(n.b)("h2",null,"ユーザーが設定しているタグの一覧を取得する"),Object(n.b)("pre",null,Object(n.b)("code",Object.assign({parentName:"pre"},{className:"language-rb"}),'@user_tags = current_user.owned_tag_list\n=> ["tag1", "tag2"]\n')))}c.isMDXComponent=!0},Bl7J:function(e,t,a){"use strict";var n=a("dwav"),r=a("q1tI"),l=a.n(r),s=a("Wbzz"),b=function(e){var t=e.siteTitle;return l.a.createElement("header",{style:{background:"white",marginBottom:"1.45rem"}},l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"1.45rem 1.0875rem"}},l.a.createElement("h1",{style:{margin:0}},l.a.createElement(s.Link,{to:"/",style:{color:"black",textDecoration:"none"}},t))))};b.defaultProps={siteTitle:""};var c=b;a("8ypT"),t.a=function(e){var t=e.children,a=n.data;return l.a.createElement(l.a.Fragment,null,l.a.createElement(c,{siteTitle:a.site.siteMetadata.title}),l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"0 1.0875rem 1.45rem"}},l.a.createElement("main",null,t),l.a.createElement("footer",null,"© ",(new Date).getFullYear(),", Built with"," ",l.a.createElement("a",{href:"https://www.gatsbyjs.org"},"Gatsby"),"by ",a.site.siteMetadata.author)))}},dwav:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"title":"jangajan.com","author":"@ta1kt0me"}}}}')}}]);
//# sourceMappingURL=component---src-pages-2014-10-04-acts-as-taggable-on-in-rails-md-9c3126e30f58f0f0741d.js.map