(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{Bl7J:function(e,t,n){"use strict";var a=n("dwav"),b=n("q1tI"),r=n.n(b),c=n("Wbzz"),l=function(e){var t=e.siteTitle;return r.a.createElement("header",{style:{background:"white",marginBottom:"1.45rem"}},r.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"1.45rem 1.0875rem"}},r.a.createElement("h1",{style:{margin:0}},r.a.createElement(c.Link,{to:"/",style:{color:"black",textDecoration:"none"}},t))))};l.defaultProps={siteTitle:""};var s=l;n("8ypT"),t.a=function(e){var t=e.children,n=a.data;return r.a.createElement(r.a.Fragment,null,r.a.createElement(s,{siteTitle:n.site.siteMetadata.title}),r.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"0 1.0875rem 1.45rem"}},r.a.createElement("main",null,t),r.a.createElement("footer",null,"© ",(new Date).getFullYear(),", Built with"," ",r.a.createElement("a",{href:"https://www.gatsbyjs.org"},"Gatsby"),"by ",n.site.siteMetadata.author)))}},"brx+":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return r})),n.d(t,"default",(function(){return s}));n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("91GP"),n("q1tI");var a=n("7ljp"),b=n("Bl7J");var r={},c={_frontmatter:r},l=b.a;function s(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,b={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(b[n]=e[n]);return b}(e,["components"]);return Object(a.b)(l,Object.assign({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Railsでcucumberを動かしてみます。",Object(a.b)("br",{parentName:"p"}),"\n","サンプルソースはこちらです。",Object(a.b)("br",{parentName:"p"}),"\n",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/ta1kt0me/cucumber-test/tree/first-test"}),"ta1kt0me/cucumber-test")),Object(a.b)("p",null,"cucumberを使うことになったので簡単なサンプルを作成してみます。  "),Object(a.b)("table",null,Object(a.b)("thead",{parentName:"table"},Object(a.b)("tr",{parentName:"thead"},Object(a.b)("th",Object.assign({parentName:"tr"},{align:"center"}),"ライブラリ"),Object(a.b)("th",Object.assign({parentName:"tr"},{align:"center"}),"バージョン"))),Object(a.b)("tbody",{parentName:"table"},Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"ruby"),Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"2.1.5")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"rails"),Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"4.1.5")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"cucumber"),Object(a.b)("td",Object.assign({parentName:"tr"},{align:"center"}),"1.3.17")))),Object(a.b)("p",null,"構成はこんな感じです。  "),Object(a.b)("h1",null,"Cucumberとは"),Object(a.b)("p",null,"Rubyで書けるインテグレーションテストのためのテストフレームワークの一つです。\nCucumber自体は、Railsに依存していないため、Sinatraのアプリでも使用可能です。"),Object(a.b)("h1",null,"今回やること"),Object(a.b)("p",null,"!. cucumberのインストール\n2. scaffoldで作成したアプリのトップページを表示するテストを書く"),Object(a.b)("p",null,"事前にscaffoldで適当なアプリを作成します。",Object(a.b)("br",{parentName:"p"}),"\n","今回は以下のコマンドを実行しました。  "),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"bundle exec rails g scaffold Book title:string author:string price:integer\n")),Object(a.b)("h1",null,"Cucumber"),Object(a.b)("h2",null,"最低限覚えること"),Object(a.b)("p",null,"Cucumberのテストシナリオは、GherkinというDSLで書きます。",Object(a.b)("br",{parentName:"p"}),"\n","今回はGherkinの一部だけを利用して簡単なテストを書きます。",Object(a.b)("br",{parentName:"p"}),"\n","Gherkinについては、",Object(a.b)("a",Object.assign({parentName:"p"},{href:"http://blog.eiel.info/blog/2013/02/12/gherkin/"}),"こちら"),"のサイトにわかりやすい解説があります。",Object(a.b)("br",{parentName:"p"}),"\n","また、今回のサンプルですが",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://semaphoreapp.com/blog/2013/08/14/setting-up-bdd-stack-on-a-new-rails-4-application.html"}),"こちら"),"のサイトの内容をもとに確認しています。"),Object(a.b)("h3",null,"言葉"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Feature",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"機能を表します。1つのファイルに1つだけ"))),Object(a.b)("li",{parentName:"ul"},"Scenario",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"テストのシナリオです"))),Object(a.b)("li",{parentName:"ul"},"When",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"ユーザーの動作を表します。リンクをクリックする、とか"))),Object(a.b)("li",{parentName:"ul"},"Then",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"Whenの結果どうなるか、を表します")))),Object(a.b)("p",null,"階層構造としてはこうなります。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{}),"Feature: 機能A\n    Scenario: シナリオ1\n        When ユーザーがTopページにきた時\n        Then タイトルにhogeが表示されている\n")),Object(a.b)("h3",null,"ファイル"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"features/hoge.feature",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"テストのシナリオを書くところ"))),Object(a.b)("li",{parentName:"ul"},"features/step_definitions/hoge.rb",Object(a.b)("ul",{parentName:"li"},Object(a.b)("li",{parentName:"ul"},"シナリオの動作を定義するところ")))),Object(a.b)("h2",null,"インストール"),Object(a.b)("h3",null,"Gemfile変更 & install"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"Gemfile",Gemfile:!0}),"group :test do\n  # gem 'cucumber' # githubのサンプルコードには入ってますが、いらないです。\n  gem 'cucumber-rails', require: false\n  gem 'database_cleaner'\nend\n")),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"bundle install\nbundle exec rails generate cucumber:install\n")),Object(a.b)("h2",null,"シナリオを書く"),Object(a.b)("p",null,"今回はユーザーがトップページにいる時に、タイトル文字列'Listing books'が表示されていることを確認します。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"features/home_page.feature","features/home_page.feature":!0}),"Feature: Home page\n\n  Scenario: Viwing application's home page\n    When I am on the top page\n    Then I should see the 'Listing books'\n")),Object(a.b)("p",null,"この時点でテストを実行するとエラーが出ます。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{}),"$ bundle exec rake cucumber\n   Then I should see the 'Listing books'  # features/home_page.feature:5\n      Undefined step: \"I should see the 'Listing books'\" (Cucumber::Undefined)\n      features/home_page.feature:5:in `Then I should see the 'Listing books''\n\n1 scenario (1 undefined)\n2 steps (2 undefined)\n0m0.005s\n\nYou can implement step definitions for undefined steps with these snippets:\n\nWhen(/^I am on the homepage$/) do\n  pending # express the regexp above with the code you wish you had\nend\n\nThen(/^I should see the 'Listing books'$/) do\n  pending # express the regexp above with the code you wish you had\nend\n")),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"When"),"と",Object(a.b)("inlineCode",{parentName:"p"},"Then"),"で指定した動作（ステップ）が定義されてないことが原因です。"),Object(a.b)("h2",null,"ステップを定義する"),Object(a.b)("p",null,"シナリオに書いた",Object(a.b)("inlineCode",{parentName:"p"},"When"),"と",Object(a.b)("inlineCode",{parentName:"p"},"Then"),"のステップを定義します。",Object(a.b)("br",{parentName:"p"}),"\n","文字列一致で挙動を設定します。  "),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"features/step_definitions/home_page_steps.rb","features/step_definitions/home_page_steps.rb":!0}),"When(/^I am on the top page$/) do\n  visit root_path\nend\n\nThen(/^I should see the '(.*?)'$/) do |title|\n  assert page.body.scan(title).length > 0\nend\n")),Object(a.b)("p",null,"もう一度実行します。  "),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{}),"$ bundle exec rake cucumber\neature: Home page\n\n  Scenario: Viwing application's home page # features/home_page.feature:3\n    When I am on the top page              # features/step_definitions/home_page_steps.rb:1\n    Then I should see the 'Listing books'  # features/step_definitions/home_page_steps.rb:5\n\n1 scenario (1 passed)\n2 steps (2 passed)\n0m0.081s\n")),Object(a.b)("p",null,"成功しましたね。",Object(a.b)("br",{parentName:"p"}),"\n","rspecと組み合わせることでrspecの記法できるようなります。",Object(a.b)("br",{parentName:"p"}),"\n","またcapybara-webkitやwebratと組み合わせることで、よりStepが簡単に実装できるようになると思います。  "),Object(a.b)("h1",null,"課題"),Object(a.b)("p",null,"次はFactorygirlを使ってシナリオの前提条件となるGiveを使ってみます。  "),Object(a.b)("p",null,"しまった。cucumberの最初のcは大文字が正しいかもしれない..."))}s.isMDXComponent=!0},dwav:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"title":"jangajan.com","author":"@ta1kt0me"}}}}')}}]);
//# sourceMappingURL=component---src-pages-2014-11-25-use-cucumber-md-bce95cc4dc1addc728a1.js.map