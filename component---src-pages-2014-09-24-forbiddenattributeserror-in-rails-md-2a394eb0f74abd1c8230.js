(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{Bl7J:function(e,t,n){"use strict";var a=n("dwav"),r=n("q1tI"),l=n.n(r),i=n("Wbzz"),s=function(e){var t=e.siteTitle;return l.a.createElement("header",{style:{background:"white",marginBottom:"1.45rem"}},l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"1.45rem 1.0875rem"}},l.a.createElement("h1",{style:{margin:0}},l.a.createElement(i.Link,{to:"/",style:{color:"black",textDecoration:"none"}},t))))};s.defaultProps={siteTitle:""};var c=s;n("8ypT"),t.a=function(e){var t=e.children,n=a.data;return l.a.createElement(l.a.Fragment,null,l.a.createElement(c,{siteTitle:n.site.siteMetadata.title}),l.a.createElement("div",{style:{margin:"0 auto",maxWidth:960,padding:"0 1.0875rem 1.45rem"}},l.a.createElement("main",null,t),l.a.createElement("footer",null,"© ",(new Date).getFullYear(),", Built with"," ",l.a.createElement("a",{href:"https://www.gatsbyjs.org"},"Gatsby"),"by ",n.site.siteMetadata.author)))}},"S/qk":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return l})),n.d(t,"default",(function(){return c}));n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("91GP"),n("q1tI");var a=n("7ljp"),r=n("Bl7J");var l={},i={_frontmatter:l},s=r.a;function c(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["components"]);return Object(a.b)(s,Object.assign({},i,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Rails4で、ForbiddenAttributesErrorが発生した場合の対応です。  "),Object(a.b)("h1",null,"ActiveModel::ForbiddenAttributesError発生"),Object(a.b)("p",null,"次のようなエラーが発生しました。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"ActiveModel::ForbiddenAttributesError (ActiveModel::ForbiddenAttributesError):\n  app/controllers/posts_controller.rb:13:in `create'\n")),Object(a.b)("p",null,"13行目が悪さをしているらしい..."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"app/controllers/posts_controller.rb","app/controllers/posts_controller.rb":!0}),"def create\n  @feed = Feed.new(params[:post]) # 13行目\n  ...\nend\n")),Object(a.b)("p",null,"これはmass assignmentの問題を解決するために、Rails4から標準で導入された対応により発生しました。",Object(a.b)("br",{parentName:"p"}),"\n","mass assignmentとはsubmitしたデータから簡単にModelを作ることができるRailsの仕組みです。",Object(a.b)("br",{parentName:"p"}),"\n","しかし、意図しないパラメータも含んだ状態でModelが作られるという脆弱性のため、このようなエラーが発生するようになりました。",Object(a.b)("br",{parentName:"p"}),"\n","mass assignmentの問題とその対策についての詳細な説明は",Object(a.b)("a",Object.assign({parentName:"p"},{href:"http://www.willnet.in/48"}),"Rails4.0に含まれる strong_parameters について"),"を参考にしてください。"),Object(a.b)("h1",null,"対応"),Object(a.b)("h2",null,"Model作成に必要なsubmitデータを指定する方法"),Object(a.b)("p",null,"Model作成に必要なsubmitデータを明示的に指定し、チェックする方法です。\npermitメソッドを使うことで、submitデータを絞り込みます。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"app/controllers/posts_controller.rb","app/controllers/posts_controller.rb":!0}),"def create\n  @feed = Post.new(post_params)\n  ...\nend\n\nprivate\n\ndef post_params\n  # submitしたデータのうち、Model作成に必要なものを\n  # permitの引数に指定する\n  params.require(:params).permit(\n    :title, :body\n  )\nend\n")),Object(a.b)("h2",null,"エラーを発生させない方法"),Object(a.b)("p",null,"こちらはmass assignmentの問題を解決していないため、お勧めしません。",Object(a.b)("br",{parentName:"p"}),"\n","pertmitメソッドを通さず、全てのsubmitデータを利用します。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"config/application.rb","config/application.rb":!0}),"  class Application < Rails::Application\n    # デフォルトはfalseに設定されている\n    config.action_controller.permit_all_parameters = true\n  end\n")),Object(a.b)("h1",null,"エラー発生場所"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"ActiveModel::ForbiddenAttributesError"),"は次の処理で発生します。"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"ActiveModel::ForbiddenAttributesProtection#sanitize_for_mass_assignment(attributes)")),Object(a.b)("p",null,"上述のpermitメソッドを実行することで、データはチェック済みの状態になります。",Object(a.b)("br",{parentName:"p"}),"\n","このチェック済み状態を確認するのが、",Object(a.b)("inlineCode",{parentName:"p"},"sanitize_for_mass_assignment"),"の役割です。",Object(a.b)("br",{parentName:"p"}),"\n","permitメソッドは",Object(a.b)("inlineCode",{parentName:"p"},"ActionController::Parameters"),"に定義してあります。 "),Object(a.b)("h1",null,"未チェックのsumitデータがあった場合の対応"),Object(a.b)("p",null,"未チェックのsubmitデータがあった場合の挙動をコントロールできます。",Object(a.b)("br",{parentName:"p"}),"\n",Object(a.b)("inlineCode",{parentName:"p"},"config.action_controller.action_on_unpermitted_parameters"),"を使います。"),Object(a.b)("h2",null,"エラーにする"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"config/application.rb","config/application.rb":!0}),"  class Application < Rails::Application\n    config.action_controller.action_on_unpermitted_parameters = :raise\n  end\n")),Object(a.b)("h2",null,"ログに出力する"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-rb",metastring:"config/application.rb","config/application.rb":!0}),"  class Application < Rails::Application\n    config.action_controller.action_on_unpermitted_parameters = :log\n  end\n")),Object(a.b)("p",null,"出力結果はこうなります。"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-sh"}),"Unpermitted parameters: hogehoge\n")))}c.isMDXComponent=!0},dwav:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"title":"jangajan.com","author":"@ta1kt0me"}}}}')}}]);
//# sourceMappingURL=component---src-pages-2014-09-24-forbiddenattributeserror-in-rails-md-2a394eb0f74abd1c8230.js.map